name: Deploy (placeholder)

on:
  workflow_dispatch:
    # Manual only; apply is intentionally not automated.
    # Add inputs here when enabling apply/destroy.

permissions:
  contents: read
  id-token: write # Required for future OIDC to AWS; no credentials stored in repo.

jobs:
  terraform-apply:
    name: Terraform apply (manual placeholder)
    runs-on: ubuntu-latest
    if: false # Prevent execution until explicitly enabled.
    defaults:
      run:
        working-directory: terraform
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      # Configure AWS credentials via OIDC using the role ARN output from Terraform.
      # Set repo/org variable GHA_TERRAFORM_ROLE_ARN from terraform output github_actions_role_arn.
      - name: Configure AWS credentials (OIDC)
        uses: aws-actions/configure-aws-credentials@v4
        with:
          role-to-assume: ${{ vars.GHA_TERRAFORM_ROLE_ARN }}
          aws-region: ${{ vars.AWS_REGION }}
        if: false # keep disabled until deployment is approved and role ARN is wired

      # Terraform backend init would be configured once remote state is defined.
      # - name: Terraform init (with backend)
      #   run: terraform init -input=false -upgrade

      # Apply would run only after explicit approval.
      # - name: Terraform apply
      #   run: terraform apply -auto-approve -lock=true -input=false

    # Notes:
    # - Apply is manual to keep production changes auditable and approval-gated.
    # - CI validation remains separate to avoid using backend/state during PR checks.
    # - Backend is omitted in PR validation to prevent accidental state writes from forks.
